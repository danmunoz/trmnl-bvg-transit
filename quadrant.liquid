{% if trmnl.plugin_settings.custom_fields_values.modes %}
  {% assign preferred_modes_string = trmnl.plugin_settings.custom_fields_values.modes %}
{% else %}
  {% assign preferred_modes_string = "U,S,T" %}
{% endif %}
{% assign preferred_modes_raw = preferred_modes_string %}

<div class="layout layout--top">
  <div class="stretch-y">
    <table class="table table--bordered table--compact">
        {% render "half_header" %}
      <tbody>
        {% assign count = 0 %}
        {% for item in departures %}
        {% assign mode = item.line.productName | slice: 0 %}
        {% if preferred_modes_raw contains mode %}
        {% assign delay_minutes = item.delay | divided_by: 60 %}
        {% assign count = count | plus: 1 %}
        <tr>
            <td><span class="label label--small">
                {{ item.plannedWhen | date: "%H:%M" }}
                {% if item.cancelled == true %}
                <img class="image" src="https://img.icons8.com/ios/25/cancel.png" height="13"/>
                {% endif %}
            </span></td>
          <td><span class="label label--small">{{ item.direction | truncate: 40 }}</span></td>
          <td>
            <span class="label label--small">
              {% case mode %}
              {% when "T" %}
              <img class="image" src="https://img.icons8.com/ios/25/tram.png" height="13"/>
              {% when "U" %}
              <img class="image" src="https://img.icons8.com/ios-filled/25/subway.png" height="13"/>
              {% when "B" %}
              <img class="image" src="https://img.icons8.com/ios-filled/25/bus.png" height="13"/>
              {% else %}
              <img class="image" src="https://img.icons8.com/ios/25/train.png" height="13"/>
              {% endcase %}
              {{ item.line.name }}
            </span>
          </td>
        </tr>
        {% endif %}
        {% if count == 4 %}
            {% break %}
        {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="title_bar">
  <img class="image" src="https://images.icon-icons.com/3911/PNG/512/bvg_logo_icon_247409.png"/>
  <span class="title">BVG - Berlin </span>
  <span class="instance">{{ "now" | date: '%s' | plus: trmnl.user.utc_offset | date: "%d.%m.%Y %H:%M" }}</span>
</div>
